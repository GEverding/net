<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>net.http.server documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Net</span> <span class="project-version">0.3.3-beta8</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="intro.html"><div class="inner"><span>Overview</span></div></a></li><li class="depth-1 "><a href="echo.html"><div class="inner"><span>An echo server</span></div></a></li><li class="depth-1 "><a href="chat.html"><div class="inner"><span>A chat server</span></div></a></li><li class="depth-1 "><a href="tls.html"><div class="inner"><span>TLS support</span></div></a></li><li class="depth-1 "><a href="http-server.html"><div class="inner"><span>HTTP servers</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></div></li><li class="depth-3"><a href="net.codec.b64.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>b64</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>core</span></div></div></li><li class="depth-3 branch"><a href="net.core.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3"><a href="net.core.concurrent.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>concurrent</span></div></a></li><li class="depth-2"><a href="net.http.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-3 branch"><a href="net.http.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-3 current"><a href="net.http.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-2 branch"><a href="net.ssl.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-2 branch"><a href="net.tcp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcp</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ty</span></div></div></li><li class="depth-3 branch"><a href="net.ty.bootstrap.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bootstrap</span></div></a></li><li class="depth-3 branch"><a href="net.ty.buffer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>buffer</span></div></a></li><li class="depth-3 branch"><a href="net.ty.channel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>channel</span></div></a></li><li class="depth-3 branch"><a href="net.ty.future.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>future</span></div></a></li><li class="depth-3"><a href="net.ty.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="net.http.server.html#var-*request-ctx*"><div class="inner"><span>*request-ctx*</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var--.3Eparams"><div class="inner"><span>-&gt;params</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var--.3Erequest"><div class="inner"><span>-&gt;request</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-assoc-body-params"><div class="inner"><span>assoc-body-params</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-backpressure-fn"><div class="inner"><span>backpressure-fn</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-body-decoder"><div class="inner"><span>body-decoder</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-ChunkEncoder"><div class="inner"><span>ChunkEncoder</span></div></a></li><li class="depth-2"><a href="net.http.server.html#var-chunk-.3Ehttp-object"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chunk-&gt;http-object</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-close-fn"><div class="inner"><span>close-fn</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-content-chunk.3F"><div class="inner"><span>content-chunk?</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-data-.3Eresponse"><div class="inner"><span>data-&gt;response</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-default-aggregated-length"><div class="inner"><span>default-aggregated-length</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-default-chunk-size"><div class="inner"><span>default-chunk-size</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-default-inbuf"><div class="inner"><span>default-inbuf</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-default-response-write-executor"><div class="inner"><span>default-response-write-executor</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-executor.3F"><div class="inner"><span>executor?</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-file-chunk"><div class="inner"><span>file-chunk</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-get-host-port"><div class="inner"><span>get-host-port</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-get-response"><div class="inner"><span>get-response</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-initializer"><div class="inner"><span>initializer</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-input-stream-chunk"><div class="inner"><span>input-stream-chunk</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-int-.3Estatus"><div class="inner"><span>int-&gt;status</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-last-http-content"><div class="inner"><span>last-http-content</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-netty-handler"><div class="inner"><span>netty-handler</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-parse-num"><div class="inner"><span>parse-num</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-qs-.3Ebody-params"><div class="inner"><span>qs-&gt;body-params</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-request-length"><div class="inner"><span>request-length</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-run-server"><div class="inner"><span>run-server</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-set-so-backlog.21"><div class="inner"><span>set-so-backlog!</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-write-chunk"><div class="inner"><span>write-chunk</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-write-response"><div class="inner"><span>write-response</span></div></a></li><li class="depth-1"><a href="net.http.server.html#var-write-response-listener"><div class="inner"><span>write-response-listener</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">net.http.server</h1><div class="doc"><div class="markdown"><p>Small wrapper around netty for HTTP servers. The objective here is to be mostly compatible with the vast number of available clojure HTTP server implementations.</p>
<p>In particular, we take inspiration from and try to be mostly compatible with <a href="https://github.com/mpenet/jet">jet</a>.</p>
<p>The idea is that it should be feasible to write handlers that behave like synchronous ones.</p>
<p>The main function in this namespace is <code>run-server</code></p></div></div><div class="public anchor" id="var-*request-ctx*"><h3>*request-ctx*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L78">view source</a></div></div><div class="public anchor" id="var--.3Eparams"><h3>-&gt;params</h3><div class="usage"><code>(-&gt;params dx)</code></div><div class="doc"><div class="markdown"><p>Create a param map from a Netty QueryStringDecoder</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L95">view source</a></div></div><div class="public anchor" id="var--.3Erequest"><h3>-&gt;request</h3><div class="usage"><code>(-&gt;request msg)</code></div><div class="doc"><div class="markdown"><p>Create a request map from a Netty Http Request</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L177">view source</a></div></div><div class="public anchor" id="var-assoc-body-params"><h3>assoc-body-params</h3><div class="usage"><code>(assoc-body-params request)</code></div><div class="doc"><div class="markdown"><p>Add found query and body parameters (when applicable) to a request map</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L114">view source</a></div></div><div class="public anchor" id="var-backpressure-fn"><h3>backpressure-fn</h3><div class="usage"><code>(backpressure-fn ctx)</code></div><div class="doc"><div class="markdown"><p>Stop automatically reading from the body channel when we are signalled for backpressure.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L253">view source</a></div></div><div class="public anchor" id="var-body-decoder"><h3>body-decoder</h3><div class="usage"><code>(body-decoder max-size)</code></div><div class="doc"><div class="markdown"><p>To simplify the life of downstream consumers, we create fixed-size chunks. For example, for an input payload of 42M and a chunk size of 16M, the handler function will be fed a channel containing 3 elements: 2 16M chunks and a 10M one.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L340">view source</a></div></div><div class="public anchor" id="var-ChunkEncoder"><h3>ChunkEncoder</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A simple encoding protocol for chunks</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-chunk-.3Ehttp-object"><h3>chunk-&gt;http-object</h3><div class="usage"><code>(chunk-&gt;http-object chunk)</code></div><div class="doc"><div class="markdown"><p>Convert Chunk to http-object</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L137">view source</a></div></div><div class="public anchor" id="var-close-fn"><h3>close-fn</h3><div class="usage"><code>(close-fn ctx)</code></div><div class="doc"><div class="markdown"><p>A closure over a context that will close it when called.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L261">view source</a></div></div><div class="public anchor" id="var-content-chunk.3F"><h3>content-chunk?</h3><div class="usage"><code>(content-chunk? x)</code></div><div class="doc"><div class="markdown"><p>Predicate to check for ChunkEncoder compliance</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L172">view source</a></div></div><div class="public anchor" id="var-data-.3Eresponse"><h3>data-&gt;response</h3><div class="usage"><code>(data-&gt;response {:keys [status headers]} version)</code></div><div class="doc"><div class="markdown"><p>Create a valid HttpResponse from a response map.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L85">view source</a></div></div><div class="public anchor" id="var-default-aggregated-length"><h3>default-aggregated-length</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L74">view source</a></div></div><div class="public anchor" id="var-default-chunk-size"><h3>default-chunk-size</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L70">view source</a></div></div><div class="public anchor" id="var-default-inbuf"><h3>default-inbuf</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L72">view source</a></div></div><div class="public anchor" id="var-default-response-write-executor"><h3>default-response-write-executor</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L76">view source</a></div></div><div class="public anchor" id="var-executor.3F"><h3>executor?</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L469">view source</a></div></div><div class="public anchor" id="var-file-chunk"><h3>file-chunk</h3><div class="usage"><code>(file-chunk f)</code></div><div class="doc"><div class="markdown"><p>Create an input stream chunk from a File</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L132">view source</a></div></div><div class="public anchor" id="var-get-host-port"><h3>get-host-port</h3><div class="usage"><code>(get-host-port {:keys [host port]})</code></div><div class="doc"><div class="markdown"><p>Extract host and port from a server options map, providing defaults</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L390">view source</a></div></div><div class="public anchor" id="var-get-response"><h3>get-response</h3><div class="usage"><code>(get-response {:keys [request version]} handler ctx executor)</code></div><div class="doc"><div class="markdown"><p>When an aggregated request is done buffereing, Execute the handler on it and publish the response.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L236">view source</a></div></div><div class="public anchor" id="var-initializer"><h3>initializer</h3><div class="usage"><code>(initializer {:keys [chunk-size ring-handler], :or {chunk-size default-chunk-size}, :as opts})</code></div><div class="doc"><div class="markdown"><p>An initializer is a per-connection context creator. For each incoming connections, the HTTP server codec is used, bodies are aggregated up to a certain size and then handed over to the provided handler</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L365">view source</a></div></div><div class="public anchor" id="var-input-stream-chunk"><h3>input-stream-chunk</h3><div class="usage"><code>(input-stream-chunk is)</code></div><div class="doc"><div class="markdown"><p>Fill up a ByteBuf with the contents of an input stream</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L122">view source</a></div></div><div class="public anchor" id="var-int-.3Estatus"><h3>int-&gt;status</h3><div class="usage"><code>(int-&gt;status status)</code></div><div class="doc"><div class="markdown"><p>Get a Netty HttpResponseStatus from a int</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L80">view source</a></div></div><div class="public anchor" id="var-last-http-content"><h3>last-http-content</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Empty Last Http Content</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L190">view source</a></div></div><div class="public anchor" id="var-netty-handler"><h3>netty-handler</h3><div class="usage"><code>(netty-handler handler)</code><code>(netty-handler handler {:keys [inbuf aggregate-length response-write-executor]})</code></div><div class="doc"><div class="markdown"><p>This is a stateful, per HTTP session adapter which wraps the user supplied function. We can use volatiles for keeping track of state due to the thread-safe nature of handler adapters.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L287">view source</a></div></div><div class="public anchor" id="var-parse-num"><h3>parse-num</h3><div class="usage"><code>(parse-num s)</code></div><div class="doc"><div class="markdown"><p>Parse a long integer, returning nil on failure</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L226">view source</a></div></div><div class="public anchor" id="var-qs-.3Ebody-params"><h3>qs-&gt;body-params</h3><div class="usage"><code>(qs-&gt;body-params {:keys [headers body]})</code></div><div class="doc"><div class="markdown"><p>Extract body parameters from a body when application</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L106">view source</a></div></div><div class="public anchor" id="var-request-length"><h3>request-length</h3><div class="usage"><code>(request-length {:keys [headers], :as req})</code></div><div class="doc"><div class="markdown"><p>Try extracting a request length if available</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L231">view source</a></div></div><div class="public anchor" id="var-run-server"><h3>run-server</h3><div class="usage"><code>(run-server options handler)</code><code>(run-server options)</code></div><div class="doc"><div class="markdown"><p>Create and run an HTTP server handler. HTTP server handlers rely on a handler function which must be provided separately in the 2-arity version or as the <code>:ring-handler</code> key in the options map in the 1-arity version.</p>
<p>Ring handler is a function of one argument, a correctly formed HTTP request of the following form (see <code>::request</code> spec for full form):</p>
<pre><code>{:request-method &lt;method&gt;
 :uri            &lt;uri&gt;
 :version        &lt;version&gt;
 :headers        &lt;headers&gt;
 :get-params     &lt;map&gt;
 :params         &lt;map&gt;
 :body           &lt;buf-or-channel&gt;}
</code></pre>
<p>When body is a channel, it will produce <code>ByteBuf</code> instances of up to the options <code>chunk-size</code> value.</p>
<p>The function should produce either a channel or map as a response. When the response is a channel, a single value will be consumed from it: the response map.</p>
<p>The response map should be of the form (see <code>::response</code> spec for full form):</p>
<pre><code>{:status         &lt;http-status&gt;
 :headers        &lt;headers&gt;
 :body           &lt;buf-or-channel&gt;}
</code></pre>
<p>When body is a channel, values will be consumed from it and sent out until it is closed. Otherwise, the contents will be sent out directly.</p>
<p>The options map is of the following form:</p>
<pre><code>{:loop-thread-count       &lt;threadcount&gt;
 :disable-epoll           &lt;boolean&gt;
 :host                    &lt;host&gt;
 :port                    &lt;port&gt;
 :chunk-size              &lt;chunk-size&gt;
 :inbuf                   &lt;input-channel-buffer&gt;
 :so-backlog              &lt;backlog&gt;
 :aggregate-length        &lt;body-aggregate-max-size&gt;
 :response-write-executor &lt;ExecutorService used to run/generate sync responses&gt;}
</code></pre>
<p><code>run-server</code> returns a function of no args which when called will shut down the server gracefully.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L395">view source</a></div></div><div class="public anchor" id="var-set-so-backlog.21"><h3>set-so-backlog!</h3><div class="usage"><code>(set-so-backlog! bootstrap {:keys [so-backlog]})</code></div><div class="doc"><div class="markdown"><p>Adjust Bootstrap socket backlog</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L385">view source</a></div></div><div class="public anchor" id="var-write-chunk"><h3>write-chunk</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Multimethod used to write into the request’s body.</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L267">view source</a></div></div><div class="public anchor" id="var-write-response"><h3>write-response</h3><div class="usage"><code>(write-response ctx version {:keys [body], :as resp})</code></div><div class="doc"><div class="markdown"><p>Write an HTTP response out to a Netty Context</p></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L213">view source</a></div></div><div class="public anchor" id="var-write-response-listener"><h3>write-response-listener</h3><div class="usage"><code>(write-response-listener ctx body)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/pyr/net/blob/0.3.3-beta8/src/net/http/server.clj#L204">view source</a></div></div></div></body></html>